<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit Review Manager - Live Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Audit Review Manager</h1>
            <p class="subtitle">Live Peer Review Dashboard</p>
        </header>

        <!-- PR Configuration -->
        <div class="pr-config">
            <h3>üìã Pull Request Configuration</h3>
            
            <!-- Direct URL Input -->
            <div class="pr-url-input">
                <input type="text" id="prUrl" placeholder="Paste GitHub PR URL (e.g., https://github.com/owner/repo/pull/123)">
                <button id="syncPRUrl" class="btn btn-primary">üîÑ Sync from URL</button>
            </div>
            
            <div class="divider">OR</div>
            
            <!-- Manual Input -->
            <div class="pr-inputs">
                <input type="text" id="prOwner" placeholder="Owner (e.g., oak-security)">
                <input type="text" id="prRepo" placeholder="Repository">
                <input type="number" id="prNumber" placeholder="PR #">
                <button id="syncPR" class="btn btn-primary">üîÑ Sync PR</button>
            </div>
        </div>

        <!-- PR Tabs -->
        <div class="pr-tabs-container" id="prTabsContainer" style="display: none;">
            <div class="pr-tabs" id="prTabs"></div>
            <button id="managePRs" class="btn btn-secondary btn-manage-prs">‚öôÔ∏è Manage PRs</button>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Auto-refresh:</label>
                <select id="refreshInterval">
                    <option value="manual" selected>Manual</option>
                    <option value="60">1 minute</option>
                    <option value="300">5 minutes</option>
                    <option value="600">10 minutes</option>
                </select>
            </div>
            
            <button id="manualRefresh" class="btn btn-secondary">üîÑ Refresh Now</button>
            <button id="generatePDF" class="btn btn-primary">üìÑ Generate PDF</button>
            <button id="manageResearchers" class="btn btn-secondary">üë• Manage Researchers</button>
            <button id="toggleNightMode" class="btn btn-secondary">üåô Night Mode</button>
            
            <div class="last-updated">
                Last updated: <span id="lastUpdated">Never</span>
            </div>
        </div>

        <!-- Researchers Management Modal -->
        <div id="researchersModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Manage Researchers</h2>
                
                <div class="researchers-list" id="researchersList"></div>
                
                <div class="add-researcher">
                    <h3>Add New Researcher</h3>
                    <input type="text" id="newResearcherHandle" placeholder="GitHub handle">
                    <button id="addResearcher" class="btn btn-primary">Add</button>
                </div>
            </div>
        </div>

        <!-- PR Management Modal -->
        <div id="prManagementModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Manage Pull Requests</h2>
                
                <div class="pr-list" id="prList"></div>
                
                <div class="add-pr">
                    <h3>Add New PR</h3>
                    <div class="pr-url-input">
                        <input type="text" id="newPrUrl" placeholder="Paste GitHub PR URL (e.g., https://github.com/owner/repo/pull/123)">
                        <button id="addPRFromUrl" class="btn btn-primary">Add from URL</button>
                    </div>
                    
                    <div class="divider">OR</div>
                    
                    <div class="pr-inputs">
                        <input type="text" id="newPrOwner" placeholder="Owner (e.g., oak-security)">
                        <input type="text" id="newPrRepo" placeholder="Repository">
                        <input type="number" id="newPrNumber" placeholder="PR #">
                    </div>
                    <button id="addPR" class="btn btn-primary">Add PR</button>
                </div>
            </div>
        </div>

        <div id="loading" class="loading">Loading data...</div>
        <div id="error" class="error" style="display: none;"></div>

        <div id="content" style="display: none;">
            <!-- Repository Info -->
            <div class="repo-info" id="repoInfo"></div>

            <!-- Researchers List -->
            <div class="researchers-section" id="researchersSection"></div>

            <!-- Progress Pie Charts -->
            <div class="progress-charts">
                <div class="chart-container">
                    <h3>Review Progress</h3>
                    <svg class="pie-chart" viewBox="0 0 200 200" id="reviewPieChart">
                        <circle cx="100" cy="100" r="90" fill="none" stroke="#e0e0e0" stroke-width="20" class="pie-bg"></circle>
                        <circle cx="100" cy="100" r="90" fill="none" stroke="#28a745" stroke-width="20" 
                                stroke-dasharray="0 565.48" stroke-dashoffset="141.37" 
                                transform="rotate(-90 100 100)" class="pie-progress" id="reviewProgress"></circle>
                        <text x="100" y="100" text-anchor="middle" dominant-baseline="middle" class="pie-text" id="reviewPercentage">0%</text>
                    </svg>
                    <p class="chart-label"><span id="reviewCompleted">0</span> / <span id="reviewTotal">0</span> reviewed</p>
                </div>
                <div class="chart-container">
                    <h3>Reporting Progress</h3>
                    <svg class="pie-chart" viewBox="0 0 200 200" id="reportPieChart">
                        <circle cx="100" cy="100" r="90" fill="none" stroke="#e0e0e0" stroke-width="20" class="pie-bg"></circle>
                        <circle cx="100" cy="100" r="90" fill="none" stroke="#007bff" stroke-width="20" 
                                stroke-dasharray="0 565.48" stroke-dashoffset="141.37" 
                                transform="rotate(-90 100 100)" class="pie-progress" id="reportProgress"></circle>
                        <text x="100" y="100" text-anchor="middle" dominant-baseline="middle" class="pie-text" id="reportPercentage">0%</text>
                    </svg>
                    <p class="chart-label"><span id="reportCompleted">0</span> / <span id="reportTotal">0</span> reported</p>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="stats-grid">
                <div class="stat-card reported">
                    <h3>Reported ‚úÖ</h3>
                    <div class="stat-value" id="reportedCount">0</div>
                </div>
                <div class="stat-card non-reported">
                    <h3>Non-Reported ‚ùå</h3>
                    <div class="stat-value" id="nonReportedCount">0</div>
                </div>
                <div class="stat-card pending">
                    <h3>Pending</h3>
                    <div class="stat-value" id="pendingCount">0</div>
                </div>
                <div class="stat-card duplicates">
                    <h3>Duplicate Groups</h3>
                    <div class="stat-value" id="duplicatesCount">0</div>
                </div>
            </div>

            <!-- Reaction Stats -->
            <section class="section">
                <h2>Reaction Completion Stats</h2>
                <div id="reactionStats"></div>
            </section>

            <!-- Duplicate Groups -->
            <section class="section" id="duplicateGroupsSection" style="display: none;">
                <h2>Duplicate Findings</h2>
                <div id="duplicateGroups"></div>
            </section>

            <!-- Duplicates Assignments -->
            <section class="section" id="duplicateAssignmentsSection" style="display: none;">
                <h2>Duplicates</h2>
                <div id="duplicateAssignments"></div>
            </section>

            <!-- All Comments -->
            <section class="section">
                <h2>All Comments</h2>
                <div class="table-actions">
                    <div class="column-buttons">
                        <button id="addColumn" class="btn btn-secondary">‚ûï Add Column</button>
                        <button id="removeColumn" class="btn btn-secondary" style="display: none;">‚ûñ Remove Column</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table id="commentsTable">
                        <thead id="commentsTableHead"></thead>
                        <tbody id="commentsTableBody"></tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

